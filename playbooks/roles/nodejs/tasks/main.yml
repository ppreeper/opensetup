---
- name: nodejs repo key
  ansible.builtin.apt_key:
    url: "https://deb.nodesource.com/gpgkey/nodesource.gpg.key"
    state: present
    keyring: /usr/share/keyrings/nodesource.gpg
  become: true
  when: ansible_os_family == 'Debian'

- name: nodejs repository remove nodesource.list
  ansible.builtin.file:
    path: "/etc/apt/sources.list.d/nodesource.list"
    state: absent
  when: ansible_os_family == 'Debian'

- name: nodejs repository add nodesource
  ansible.builtin.apt_repository:
    validate_certs: no
    repo: "deb [arch=amd64 signed-by=/usr/share/keyrings/nodesource.gpg] http://deb.nodesource.com/node_{{ node_version }}.x {{ ansible_lsb.codename|lower }} main"
    state: present
    filename: nodesource
  when: ansible_os_family == 'Debian' and ansible_lsb.codename != 'elsie'

- name: nodejs repository add nodesource lmdb5
  ansible.builtin.apt_repository:
    validate_certs: no
    repo: "deb [arch=amd64 signed-by=/usr/share/keyrings/nodesource.gpg] http://deb.nodesource.com/node_{{ node_version }}.x bullseye main"
    state: present
    filename: nodesource
  when: ansible_os_family == 'Debian' and ansible_lsb.codename == 'elsie'

- name: nodejs repository add nodesource src
  ansible.builtin.apt_repository:
    validate_certs: no
    repo: "deb-src [arch=amd64 signed-by=/usr/share/keyrings/nodesource.gpg] http://deb.nodesource.com/node_{{ node_version }}.x {{ ansible_lsb.codename|lower }} main"
    state: present
    filename: nodesource
    update_cache: yes
  when: ansible_os_family == 'Debian' and ansible_lsb.codename != 'elsie'

- name: nodejs repository add nodesource src lmdb5
  ansible.builtin.apt_repository:
    validate_certs: no
    repo: "deb-src [arch=amd64 signed-by=/usr/share/keyrings/nodesource.gpg] http://deb.nodesource.com/node_{{ node_version }}.x bullseye main"
    state: present
    filename: nodesource
    update_cache: yes
  when: ansible_os_family == 'Debian' and ansible_lsb.codename == 'elsie'

- name: nodejs install
  ansible.builtin.apt:
    name:
      - nodejs
    state: latest
  when: ansible_os_family == 'Debian'

- name: npmrc
  ansible.builtin.template:
    src: npmrc
    dest: "{{ home }}/.npmrc"
    mode: "0644"
    owner: "{{ user }}"
    group: "{{ user }}"

- name: check bash installed
  ansible.builtin.stat:
    path: "/usr/bin/bash"
  register: stat_bash

- name: cfg 20_js bash
  ansible.builtin.template:
    src: "20_js.cfg"
    dest: "{{ config }}/cfg/20_js.cfg"
    mode: "0644"
    owner: "{{ user }}"
    group: "{{ user }}"
  when: stat_bash.stat.exists

- name: check zsh installed
  ansible.builtin.stat:
    path: "/usr/bin/zsh"
  register: stat_zsh

- name: cfg 20_js zsh
  ansible.builtin.template:
    src: "20_js.cfg"
    dest: "{{ config }}/zsh/cfg/20_js.cfg"
    mode: "0644"
    owner: "{{ user }}"
    group: "{{ user }}"
  when: stat_zsh.stat.exists
